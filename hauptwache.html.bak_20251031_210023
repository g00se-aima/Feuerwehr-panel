
<!DOCTYPE html>
<html lang="de">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Hauptwache</title>
	<link rel="stylesheet" href="style.css">
</head>

<body>
<script src="script.js"></script>
<script src="buttons.js"></script>
<!-- ...existing code... -->
<header>
	<div class="left-controls">
		<button class="btn btn-small" id="btn-uebersicht">Ãœbersicht</button>
		<button class="btn btn-black" id="btn-hauptmenu" onclick="window.location.href='index.html'">Hauptmenu</button>
		<div class="meta" id="page-indicator"><span class="page-title">Hauptwache</span></div>
	</div>
	<div style="display:flex;align-items:center;gap:12px">
		<div style="position:relative">
			<input id="global-search" class="search-input" placeholder="Suche (Seiten & Inhalte)..." />
			<div id="search-dropdown" style="display:none;position:absolute;right:0;top:38px;background:#fff;border:1px solid #eee;border-radius:8px;box-shadow:0 6px 18px rgba(0,0,0,0.06);z-index:100;width:360px;max-width:90vw;overflow:auto"></div>
		</div>
		<div style="display:flex;gap:8px;align-items:center">
			<button class="btn btn-small" id="btn-export">Backup download</button>
			<button class="btn btn-small" id="btn-import">Restore backup</button>
			<input type="file" id="import-file" style="display:none" accept=".json"/>
		</div>
	</div>
</header>
<main class="container">
	<div class="card" style="margin-top:80px;">
		<div id="vehicle-btns" class="page-buttons"></div>
		<div id="vehicle-edit-btn" style="margin-top:18px;"></div>
	</div>
</main>






<script>
document.addEventListener('DOMContentLoaded', function() {
  if (typeof setupGlobalSearch === 'function') setupGlobalSearch();

  const allowed = [
    '1-hlf20-1',
    '1-hlf20-3',
    '1-dlk23-1',
    '1-tlf4000-1',
    'tlf-azubi',
    'tlf azubi',
    'tlfazubi'
  ].map(s => s.toLowerCase());

  function matchesAllowed(text, file) {
    const t = (text || '').toLowerCase();
    const f = (file || '').toLowerCase();
    const norm = t.replace(/[\s\-_.]+/g, '');
    return allowed.some(a => t.includes(a) || f.includes(a) || norm.includes(a.replace(/[-_.]/g, '')));
  }

  function ensureEditButton() {
    var editContainer = document.getElementById('vehicle-edit-btn');
    if (!editContainer) return;
    editContainer.innerHTML = '';
    var editBtn = document.createElement('button');
    editBtn.textContent = 'Fahrzeuge bearbeiten';
    editBtn.className = 'btn btn-small vehicleedit-btn';
    editBtn.addEventListener('click', function() {
      if (window.openVehicleEditor) return window.openVehicleEditor();
      alert('Vehicle editor not available');
    });
    editContainer.appendChild(editBtn);
  }

  function renderWhenReady() {
    const container = document.getElementById('vehicle-btns');
    if (!container) return;

    // If renderVehicleButtons is available, use it then remove unwanted buttons
    if (typeof window.renderVehicleButtons === 'function') {
      try {
        container.innerHTML = '';
        window.renderVehicleButtons(container);
      } catch (e) {
        console.error('renderVehicleButtons error', e);
      }
      // filter out unwanted buttons after brief defer
      setTimeout(function() {
        Array.from(container.querySelectorAll('button')).forEach(function(b) {
          if (!matchesAllowed(b.textContent, b.getAttribute('data-file') || '')) b.remove();
        });
        ensureEditButton();
      }, 30);
      return;
    }

    // Fallback to VEHICLE_LIST if available
    if (window.VEHICLE_LIST && Array.isArray(window.VEHICLE_LIST)) {
      container.innerHTML = '';
      window.VEHICLE_LIST.forEach(function(item) {
        var title = item[0] || '';
        var file = item[1] || '';
        if (!matchesAllowed(title, file)) return;
        var btn = document.createElement('button');
        btn.textContent = title;
        btn.className = 'btn btn-black vehicle-btn';
        if (file) {
          btn.addEventListener('click', function() { window.location.href = file; });
        }
        container.appendChild(btn);
      });
      ensureEditButton();
      return;
    }

    // retry shortly if neither is ready
    setTimeout(renderWhenReady, 50);
  }

  renderWhenReady();
});
</script>

<!-- VEHICLE FILTER SCRIPT START -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  if (typeof setupGlobalSearch === 'function') setupGlobalSearch();

  const allowed = [
    '1-hlf20-1',
    '1-hlf20-3',
    '1-dlk23-1',
    '1-tlf4000-1',
    'tlf-azubi',
    'tlf azubi',
    'tlfazubi',
    'tlf azubi'  // fallback forms
  ].map(s => s.toLowerCase());

  function matchesAllowed(text, file) {
    const t = (text || '').toLowerCase();
    const f = (file || '').toLowerCase();
    const norm = t.replace(/[\s\-\._]+/g, '');
    return allowed.some(a => t.includes(a) || f.includes(a) || norm.includes(a.replace(/[-_.]/g, '')));
  }

  function ensureEditButton() {
    const editContainer = document.getElementById('vehicle-edit-btn');
    if (!editContainer) return;
    editContainer.innerHTML = '';
    const editBtn = document.createElement('button');
    editBtn.textContent = 'Fahrzeuge bearbeiten';
    editBtn.className = 'btn btn-small vehicleedit-btn';
    editBtn.addEventListener('click', function() {
      if (window.openVehicleEditor) return window.openVehicleEditor();
      alert('Vehicle editor not available');
    });
    editContainer.appendChild(editBtn);
  }

  function renderFiltered() {
    const container = document.getElementById('vehicle-btns');
    if (!container) return;

    // preferred: if renderVehicleButtons exists, use it then filter results
    if (typeof window.renderVehicleButtons === 'function') {
      try {
        container.innerHTML = '';
        window.renderVehicleButtons(container);
        // allow render to finish then filter
        setTimeout(function() {
          Array.from(container.querySelectorAll('button')).forEach(function(b) {
            const text = (b.textContent || '').trim();
            const df = b.getAttribute('data-file') || '';
            if (!matchesAllowed(text, df)) b.remove();
          });
          ensureEditButton();
        }, 60);
        return;
      } catch (e) {
        console.error('renderVehicleButtons error', e);
      }
    }

    // fallback: use VEHICLE_LIST if available
    if (window.VEHICLE_LIST && Array.isArray(window.VEHICLE_LIST)) {
      container.innerHTML = '';
      window.VEHICLE_LIST.forEach(function(item) {
        const title = item[0] || '';
        const file = item[1] || '';
        if (!matchesAllowed(title, file)) return;
        const btn = document.createElement('button');
        btn.textContent = title;
        btn.className = 'btn btn-black vehicle-btn';
        if (file) btn.addEventListener('click', function() { window.location.href = file; });
        container.appendChild(btn);
      });
      ensureEditButton();
      return;
    }

    // try again shortly if neither is ready
    setTimeout(renderFiltered, 60);
  }

  renderFiltered();
});
</script>
<!-- VEHICLE FILTER SCRIPT END -->

<!-- ENSURE TLF AZUBI BUTTON -->
<script>
document.addEventListener('DOMContentLoaded', function(){
  try {
    var container = document.getElementById('vehicle-btns');
    if (!container) return;
    var exists = Array.from(container.querySelectorAll('button')).some(function(b){
      return /tlf\s*-?\s*azubi/i.test((b.textContent||b.innerText||''));
    });
    if (exists) return;
    var btn = document.createElement('button');
    btn.textContent = 'TLF Azubi';
    btn.className = 'btn btn-black vehicle-btn';
    btn.addEventListener('click', function(){ window.location.href = 'tlf-azubi.html'; });
    container.appendChild(btn);
  } catch (e) {
    console.error('Ensure TLF Azubi button error', e);
  }
});
</script>
